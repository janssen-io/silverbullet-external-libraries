name: "Build & Test"
runs:
  using: "composite"
  steps:
    - uses: denoland/setup-deno@v2
      with:
        deno-version: v2.x

    - name: Verify formatting
      shell: bash
      run: deno fmt --check

    - name: Run Deno test
      shell: bash
      run: deno task test

    - name: Coverage
      shell: bash
      run: deno coverage --lcov cov_profile/ > cov.lcov

    - name: Setup silverbullet
      shell: bash
      run: deno install -f --name silverbullet  --unstable-kv --unstable-worker-options -A https://get.silverbullet.md

    - name: Add Deno bin to PATH
      shell: bash
      run: echo "$HOME/.deno/bin" >> $GITHUB_PATH

    - name: Silverbullet version
      shell: bash
      run: silverbullet --version

    - name: Run Deno build task
      shell: bash
      run: deno task build:release
